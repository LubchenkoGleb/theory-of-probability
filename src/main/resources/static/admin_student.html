<html>
<header>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="value" content="A visual introduction to probability and statistics.">
    <!-- Fonts -->
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Assistant:300,400,600,700" rel="stylesheet">

    <!-- Home Page CSS -->
    <link rel="stylesheet" type="text/css" href="css/index.css">

    <!-- Full Page CSS -->
    <link rel="stylesheet" type="text/css" href="css/jquery.fullpage.css"/>

    <!--Jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Full Page -->
    <script src="js/jquery.fullpage.js"></script>
</header>
<body>
<div class="menu-bottom">
    <ul id="menu">
        <li data-menuanchor="firstPage" id='home'><a href="admin.html">Групи</a></li>
        <li data-menuanchor="secondPage" id="chapter-menu"><a href="admin_teacher.html">Викладачі</a></li>
        <li data-menuanchor="3rdPage" class="active"><a href="admin_student.html">Студенти</a></li>
        <li id="exit" style="margin-left: 500px;">Вихід</li>
    </ul>
</div>
<div class="section">
    <div class="teachers">
        <table id="studentsTable">
            <thead>
            <tr>
                <th>Id:</th>
                <th>Прізвище:</th>
                <th>Ім'я:</th>
                <th>Пошта:</th>
                <th>Статус:</th>
                <th>Група:</th>
            </tr>
            </thead>
        </table>
    </div>
    <form id="inviteStudents" method="post" class="inv">
        <h2>Надіслати лист підтвердження</h2>
        <p>
            <label>email: </label>
            <input name="email" type="text" id="inviteEmail" class="text"/>
        </p>
        <input type="submit" value="Надіслати" class="rec_button"/>
    </form>
</div>
</body>
<script>
    $('#inviteStudents').submit(function (e) {
        e.preventDefault();

        let form = document.getElementById('inviteStudents');
        let formData = objectifyForm(form);

        if (formData.email) {
            let body = new Array(formData.email);

            $.ajax({
                type: "POST",
                data: JSON.stringify(body),
                headers: {
                    "Content-Type": "application/json"
                },
                url: "/admin/invite-students",
                async: false
            });
        }
    });

    $.ajax({
        type: "GET",
        url: "/student/all",
        async: false,
        success: function (studentsRsponse) {
            // console.log('students=' + JSON.stringify(studentsRsponse));
            let studentsMenu = document.getElementById('studentsTable');

            for (let i = 0; i < studentsRsponse.length; i++) {
                let student = studentsRsponse[i].student;
                let group = studentsRsponse[i].group;

                let row = studentsMenu.insertRow(i + 1);
                let idCell = row.insertCell(0);
                idCell.innerHTML = student.id;
                let lastNameCell = row.insertCell(1);
                lastNameCell.innerHTML = student.lastName;
                let firstNameCell = row.insertCell(2);
                firstNameCell.innerHTML = student.firstName;
                let emailCell = row.insertCell(3);
                emailCell.innerHTML = student.email;
                let enableCell = row.insertCell(4);
                enableCell.innerHTML = student.enable;
                let groupCell = row.insertCell(5);
                groupCell.innerHTML = group.name;
            }
        }
    });

    function objectifyForm(formArray) {

        let returnArray = {};
        for (let i = 0; i < formArray.length; i++) {
            if (formArray[i].type !== 'submit') {
                returnArray[formArray[i]['name']] = formArray[i]['value'];
            }
        }
        return returnArray;
    }
</script>
</html>